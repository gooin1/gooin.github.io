<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<link href="../css/mapDefault.css" type="text/css" rel="stylesheet"/>
<script src="../libs/jquery-1.11.2.min.js" type="text/javascript"></script>
<script src="../libs/OpenLayers.js" type="text/javascript"></script>
<script src="../libs/zdclient.js" type="text/javascript"></script>
<script type="text/javascript">

    var map, layer;


    function init() {

        map = new OpenLayers.Map('map1', {
            controls: [
                new OpenLayers.Control.MousePosition(),
                new OpenLayers.Control.Navigation(),
                new OpenLayers.Control.LayerSwitcher(),
                new OpenLayers.Control.OverviewMap()
            ]
        });
        layer = new Zondy.Map.Layer("MDZZ", ["gdbp://MapGisLocal/OpenLayerVecterMap/ds/世界地图经纬度/sfcls/世界政区"], {
            ip: '127.0.0.1',
            port: '6163',
            isBaseLayer: true
        });
        map.addLayer(layer);
        map.setCenter(new OpenLayers.LonLat(0, 0), 2);
    }

    <!-------------------单圈缓冲区分析------------------- -->
    function singleBuffAnalysis() {
        var gRegion = new Zondy.Object.GRegion([
            new Zondy.Object.AnyLine([
                new Zondy.Object.Arc([
                    new Zondy.Object.Point2D(0.46, 30.1),
                    new Zondy.Object.Point2D(11.48, 6.22),
                    new Zondy.Object.Point2D(36.73, 7.6),
                    new Zondy.Object.Point2D(58.77, 25.51),
                    new Zondy.Object.Point2D(41, 51)
                ])
            ])
        ]);
//        //            创建一个数组用于此存放点
//        var points = new Array();
////              用for循环传入四个点的坐标
//        points[0]=new Zondy.Object.Point2D(0.46, 30.1);
//        points[1] = new Zondy.Object.Point2D(11.48, 6.22);
//        points[2] = new Zondy.Object.Point2D(36.73, 7.6);
//        points[3] = new Zondy.Object.Point2D(58.77, 25.51);
//        points[4] = new Zondy.Object.Point2D(41, 51);
//
////            构成区要素的弧段
//        var arc = new Zondy.Object.Arc(points);
////            构成区要素的折线
//        var anyLine = new Zondy.Object.AnyLine([arc]);
////            构成区要素
//        var gRegion = new Zondy.Object.GRegion([anyLine]);
//                创建构成区要素的几何信息


        var regGeom = new Zondy.Object.FeatureGeometry();
//        传入几何信息
        regGeom.setRegGeom([gRegion]);


        //            随机输出1-1502之间的整数
        <!--Math.floor 取最大整数-->
        var fillColor = Math.floor(Math.random() * 1502 + 1);

//            设置区的符号信息
        var cRegionInfo = new Zondy.Object.CRegionInfo({
            FillColor: fillColor //设置填充颜色
        });
//              设置图形参数
        var GraphicInfo = new Zondy.Object.WebGraphicsInfo({
            InfoType: 3,      //设为区类型
            RegInfo: cRegionInfo    //传入符号信息
        });


//        设置属性结构
        var attStruct = new Zondy.Object.CAttStruct({
            FldName: ["ID", "周长", "面积", "name"],
            FldNumber: 4,
            FldType: ["long", "double", "double", "string"]
        });
//          设置属性值
        var attValue = [1234845, 45546, 4444444, "mdzz"];
        var valueRow = new Zondy.Object.CAttDataRow(attValue, 1);


//            创建要素
        var feature = new Zondy.Object.Feature({
            fGeom: regGeom,                //传入几何信息
            GraphicInfo: GraphicInfo,       //传入图形参数信息
            AttValue: attValue               //传入属性值
        });
//            将要素设置为区要素
        feature.setFType(3);

//            创建要素数据集
        var featureSet = new Zondy.Object.FeatureSet();
//            设置数据集的属性结构
        featureSet.AttStruct = attStruct;
//            将要素添加到数据集中
        featureSet.addFeature(feature);


        //        实例化单圈缓冲区分析对象
        var featureBuffBySR = new Zondy.Service.FeatureBuffBySingleRing({
            ip: "127.0.0.1",
            port: "6163",
            leftRad: 10,//左缓冲半径
            rightRad: 10 //右缓冲半径
        });


////        设置必要参数
//        featureBuffBySR.sfGeometryXML = $.toJSON([regGeom]);
//        featureBuffBySR.attStructXML = $.toJSON([attStruct]);//注意:需要改为CAttStruct数组序列化为字符串
//        featureBuffBySR.attRowsXML = $.toJSON([valueRow]); //注意:需要修改为将CAttDataRow[]数组序列化为字符串
//        featureBuffBySR.traceRadius = 0.0001;
//        featureBuffBySR.resultName = "gdbp://MapGisLocal/OpenLayerVecterMap/ds/世界地图经纬度/sfcls/缓冲结果13" ;
//        featureBuffBySR.execute(AnalysisSuccess);

        //设置必要参数
        featureBuffBySR.sfGeometryXML = $.toJSON([regGeom]); //几何信息
        featureBuffBySR.attStructXML = $.toJSON([attStruct]);//属性结构
        featureBuffBySR.attRowsXML = $.toJSON([valueRow]);//属性值
        featureBuffBySR.traceRadius = 0.0001;
        featureBuffBySR.resultName = "gdbp://MapGisLocal/OpenLayerVecterMap/sfcls/缓冲结果" + getCurrentTime();

        featureBuffBySR.execute(AnalysisSuccess);


//          创建一个编辑服务类
        var editService = new Zondy.Service.EditLayerFeature("gdbp://MapGisLocal/OpenLayerVecterMap/ds/世界地图经纬度/sfcls/世界政区",
                {
                    ip: "127.0.0.1", //服务器ip
                    port: "6163"       //端口
                });

//            将要素数据集添加到图层中并使用回调函数
        editService.add(featureSet);

    }

    function AnalysisSuccess(data) {
        if (data.results) {
            if (data.results.length != 0) {
                var resultLayer = new Zondy.Map.Layer("结果图层", [data.results[0].Value], {
                    ip: '127.0.0.1',
                    port: '6163',
                    isBaseLayer: false
                });
                map.addLayer(resultLayer);
            }
        } else {
            alert('缓冲失败,请检查参数');
        }
    }

    function getCurrentTime() {
        var now = new Date();

        var year = now.getFullYear();
        var month = now.getMonth() + 1;
        var day = now.getDate();

        var hh = now.getHours();
        var mm = now.getMinutes();
        var ss = now.getSeconds();

        var clock = year + "-";

        if (month < 10) clock += "0";
        clock += month + "-";

        if (day < 10) clock += "0";
        clock += day + "-";

        if (hh < 10) clock += "0";
        clock += hh;

        if (mm < 10) clock += "0";
        clock += mm;

        if (ss < 10) clock += "0";
        clock += ss;
        return (clock);
    }


</script>


<body onload="init()">
<div>
    <input type="button" class="ButtonLib" value="单层缓冲区分析" onclick="singleBuffAnalysis()">
</div>
<div id="map1">

</div>

</body>
</html>