<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="../css/mapDefault.css" type="text/css" rel="stylesheet"/>
    <script src="../libs/jquery-1.7.1.min.js" type="text/javascript"></script>
    <script src="../libs/OpenLayers.js" type="text/javascript"></script>
    <script src="../libs/zdclient.js" type="text/javascript"></script>
    <script src="../libs/jsonformat/json2.js" type="text/javascript"></script>
    <script src="../libs/jsonformat/jsonExtend.js" type="text/javascript"></script>
    <script type="text/javascript">
        var map, layer;

        function init() {
            map = new OpenLayers.Map("map1", {
                controls: [
                    new OpenLayers.Control.MousePosition(),
                    new OpenLayers.Control.LayerSwitcher(),
                    new OpenLayers.Control.Navigation()
                ]
            });

            layer = new Zondy.Map.Doc("mdzz", "WorldMKT", {
                ip: "127.0.0.1",
                port: "6163",
                isBaseLayer: true
            });
            map.addLayer(layer);
            map.setCenter(new OpenLayers.LonLat(11544046, 4312771), 3);
        }

        function queryByPolygon() {
            var queryStruct = new Zondy.Service.QueryFeatureStruct();
            queryStruct.IncludeGeometry = true;

//            创建线查询
//            var lineObj = new Array();
//            lineObj[0] = new Zondy.Object.Point2D(11544046, 4312771);
//            lineObj[1] = new Zondy.Object.Point2D(1623478, 5003018);
//            var polyLine = new Zondy.Object.PolyLineForQuery(lineObj);

            var PolygonObj = new Array();
            PolygonObj[0] = new Zondy.Object.Point2D(11544046, 4312771);
            PolygonObj[1] = new Zondy.Object.Point2D(15497029, 4350532);
            PolygonObj[2] = new Zondy.Object.Point2D(14518568, 984626);
            PolygonObj[3] = new Zondy.Object.Point2D(10330754, 554103);
            var polyPolygon = new Zondy.Object.PolyLineForQuery(PolygonObj);

            var queryParm = new Zondy.Service.QueryParameter({

//                geometry: polyLine,//查询线
                geometry: polyPolygon,//查询矩形
                geometryType:"line",
                resultFormat: "json",
                struct: queryStruct
            });

            queryParm.recordNumber = 1000;
            var queryService = new Zondy.Service.QueryDocFeature(queryParm, "WorldMKT", 1, {
                ip: "127.0.0.1",
                port: "6163"
            });

            queryService.query(onSuccess);
        }
        function onSuccess(data) {

            var formatData = JSON.stringify(data);
            Process(formatData, 2, "resultTable")

        }


    </script>
</head>
<body onload="init()">
<div>
    <input type="button" class="ButtonLib" value="OID查询" onclick="queryByPolygon()"/>
</div>
<div id="map1"></div>
<aside id="resultTable"></aside>

</body>
</html>