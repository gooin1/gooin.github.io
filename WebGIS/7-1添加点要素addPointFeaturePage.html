<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>添加点要素</title>
    <link href="../css/mapDefault.css" type="text/css" rel="stylesheet">
    <script src="../libs/jquery-1.11.2.min.js" type="text/javascript"></script>
    <script src="../libs/OpenLayers.js" type="text/javascript"></script>
    <script src="../libs/zdclient.js" type="text/javascript"></script>
    <script type="text/javascript">
        var map, layer;
        function init() {
            map = new OpenLayers.Map("map1", {
                controls: [
                    new OpenLayers.Control.MousePosition(),
                    new OpenLayers.Control.LayerSwitcher(),
                    new OpenLayers.Control.Navigation()
                ]
            });
            layer = new Zondy.Map.Layer("MDZZ", ["gdbp://MapGisLocal/OpenLayerVecterMap/ds/世界地图经纬度/sfcls/主要城市"],
                    {
                        ip: "127.0.0.1",
                        port: "6163",
                        isBaseLayer: true
                    });


            map.addLayer(layer);
            map.setCenter(new OpenLayers.LonLat(0, 0), 1);
        }

        function addPoint() {
//          创建一个点形状
            var gPoint = new Zondy.Object.GPoint(78, -35);
//          设置当前点要素的几何信息
            var fGeom = new Zondy.Object.FeatureGeometry({PntGeom: [gPoint]});
//           描述点要素的符号参数信息
            var pointInfo = new Zondy.Object.CPointInfo({
                Angle: 0, //旋转角度
                Color: 23,//颜色
                Space: 0,//间距
                SymHeight: 12,//点的高度
                SymWidth: 12,//点的宽度
                SymID: 7     //符号id
            });
//            设置当前点要素的图形参数
            var webGraphicInfo = new Zondy.Object.WebGraphicsInfo({
                InfoType: 1, //1为点,2为线,3为区
                PntInfo: pointInfo
            });
//          设置属性结构
            var attStruct = new Zondy.Object.CAttStruct({
                FldName: ["Cname", "CNTRY_NAME", "POPULATION"],
                FldNumber: 3,
                FldType: ["string", "string", "double"]
            });
//            设置添加点要素的属性
            var attValue = ['湖蓝', 'CHINA', 1.0];
//            创建点要素
            var feature = new Zondy.Object.Feature({
                fGeom: fGeom,//几何信息
                GraphicInfo: webGraphicInfo,//图形信息
                AttValue: attValue//属性信息
            });
            feature.setFType(1);//设置要素为点要素  1为点,2为线,3为区
//            创建一个要素数据集
            var featureSet = new Zondy.Object.FeatureSet();
            featureSet.clear();
//            给要素集添加数据结构
            featureSet.AttStruct = attStruct;
//            添加要素到数据集中
            featureSet.addFeature(feature);

//            创建一个编辑服务类
            var editService = new Zondy.Service.EditLayerFeature("gdbp://MapGisLocal/OpenLayerVecterMap/ds/世界地图经纬度/sfcls/主要城市",
                    {
                        ip: "127.0.0.1",
                        port: "6163"
                    });

            editService.add(featureSet, onSuccess);
        }
        function onSuccess(result) {
            if(result){
                alert("添加成功");
//                刷新地图
                map.baseLayer.redraw(true);
            }else{
                alert("添加失败");
            }
        }


    </script>

</head>
<body onload="init()">
<div>
    <input type="button" class="ButtonLib" value="坐标添加点" onclick="addPoint()">
</div>


<div id="map1"></div>
<aside id="resultTable"></aside>
</body>
</html>